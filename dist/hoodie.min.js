// Hoodie.js - 0.6.5
// https://github.com/hoodiehq/hoodie.js
// Copyright 2012 - 2014 https://github.com/hoodiehq/
// Licensed Apache License 2.0

!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.Hoodie=a():"undefined"!=typeof global?global.Hoodie=a():"undefined"!=typeof self&&(self.Hoodie=a())}(function(){return function a(b,c,d){
/**
 * Description
 * @method e
 * @param {} g
 * @param {} h
 * @return MemberExpression
 */
function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return LogicalExpression
 */
function c(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),c=d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return void 0===f||d.call(a,f)}var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString;
/**
 * Description
 * @method exports
 * @return i
 */
b.exports=function f(){var a,b,d,e,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],e=a[b],i!==e&&(l&&e&&(c(e)||(g=Array.isArray(e)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=f(l,h,e)):void 0!==e&&(i[b]=e));return i}},{}],2:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){var b=this;if(!(b instanceof c))throw new Error("usage: new Hoodie(url);");a&&(b.baseUrl=a.replace(/\/+$/,"")),
/**
 * Description
 * @method extend
 * @param {} a
 * @return 
 */
b.extend=function(a){a(b)},b.extend(o),b.extend(q),b.extend(p),b.extend(i),b.extend(l),b.extend(n),b.extend(k),b.store.patchIfNotPersistant(),b.extend(m),b.extend(h),b.extend(f),b.extend(g),b.extend(j),b.config.init(),b.id.init(),b.account.username=b.config.get("_account.username"),b.remote.init(),b.account.checkPasswordReset(),b.id.subscribeToOutsideEvents(),b.config.subscribeToOutsideEvents(),b.store.subscribeToOutsideEvents(),b.store.bootstrapDirtyObjects(),b.remote.subscribeToOutsideEvents(),b.task.subscribeToOutsideEvents(),b.account.authenticate().then(function(){b.remote.connect()}),e.addEventListener("online",b.checkConnection,!1),e.addEventListener("offline",b.checkConnection,!1),b.checkConnection(),d(b)}
/**
 * Description
 * @method d
 * @param {} a
 * @return 
 */
function d(a){for(var b=0;b<r.length;b++)r[b](a)}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("./hoodie/account"),g=a("./hoodie/remote"),h=a("./hoodie/config"),i=a("./hoodie/connection"),j=a("./hoodie/id"),k=a("./hoodie/store"),l=a("./hoodie/dispose"),m=a("./hoodie/task"),n=a("./hoodie/open"),o=a("./lib/events"),p=a("./utils/request"),q=a("./utils/promises"),r=[];
/**
 * Description
 * @method extend
 * @param {} a
 * @return 
 */
c.extend=function(a){r.push(a)},b.exports=c},{"./hoodie/account":3,"./hoodie/config":4,"./hoodie/connection":5,"./hoodie/dispose":6,"./hoodie/id":7,"./hoodie/open":8,"./hoodie/remote":9,"./hoodie/store":10,"./hoodie/task":11,"./lib/events":15,"./utils/promises":22,"./utils/request":23}],3:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @param {} b
 * @return CallExpression
 */
function b(b){return a.config.set(R,b)}
/**
 * Description
 * @method c
 * @return CallExpression
 */
function c(){return a.config.get(R)}
/**
 * Description
 * @method h
 * @return CallExpression
 */
function h(){return a.config.unset(R)}
/**
 * Description
 * @method i
 * @return 
 */
function i(){a.on("remote:error:unauthenticated",j)}
/**
 * Description
 * @method j
 * @return SequenceExpression
 */
function j(){return M=void 0,N.authenticate()}
/**
 * Description
 * @method k
 * @param {} b
 * @return ConditionalExpression
 */
function k(b){return N.username!==b?(N.username=b,a.config.set("_account.username",b)):void 0}
/**
 * Description
 * @method l
 * @param {} b
 * @return ConditionalExpression
 */
function l(b){return b.userCtx.name?(M=!0,a.resolveWith(N.username)):N.hasAnonymousAccount()?N.signIn(N.username,c()):(M=!1,N.trigger("error:unauthenticated"),a.reject())}
/**
 * Description
 * @method m
 * @param {} a
 * @param {} b
 * @return FunctionExpression
 */
function m(a,b){return function(c){return N.trigger("signup",a),O._rev=c.rev,o(a,b)}}
/**
 * Description
 * @method n
 * @param {} b
 * @return FunctionExpression
 */
function n(b){return function(c){return"HoodieConflictError"===c.name&&(c.message="Username "+b+" already exists"),a.rejectWith(c)}}
/**
 * Description
 * @method o
 * @param {} b
 * @param {} c
 * @param {} e
 * @param {} f
 * @return SequenceExpression
 */
function o(b,c,e,f){return f||(f=a.defer()),d.setTimeout(function(){var a=K(b,c);a.done(f.resolve),a.fail(function(a){"HoodieAccountUnconfirmedError"===a.name?o(b,c,e,f):f.reject.apply(f,arguments)})},300),f.promise()}
/**
 * Description
 * @method p
 * @param {} b
 * @return SequenceExpression
 */
function p(b){return b=b||{},function(c){var d,e,f;return d=a.defer(),e=c.name.replace(/^user(_anonymous)?\//,""),f=c.roles[0],-1!==c.roles.indexOf("error")?(N.fetch(e).fail(d.reject).done(function(){return d.reject(O.$error)}),d.promise()):-1===c.roles.indexOf("confirmed")?d.reject({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(k(e),M=!0,b.silent||b.reauthenticated||(N.hasAnonymousAccount()?N.trigger("signin:anonymous",e):N.trigger("signin",e,f)),b.reauthenticated&&N.trigger("reauthenticated",e),N.fetch(),d.resolve(e,c.roles[0]))}}
/**
 * Description
 * @method q
 * @param {} b
 * @return SequenceExpression
 */
function q(b){var c;return b.$error?(c=b.$error,c.object=b,delete c.object.$error):c={name:"HoodiePendingError",message:"Password reset is still pending"},a.rejectWith(c)}
/**
 * Description
 * @method r
 * @param {} b
 * @return ConditionalExpression
 */
function r(b){return"HoodieUnauthorizedError"===b.name?(a.config.unset("_account.resetPasswordId"),N.trigger("passwordreset"),a.resolve()):a.rejectWith(b)}
/**
 * Description
 * @method s
 * @return SequenceExpression
 */
function s(){var b=a.defer();return N.one("passwordreset",b.resolve),N.on("error:passwordreset",t),N.on("error:passwordreset",b.reject),b.always(function(){N.unbind("passwordreset",b.resolve),N.unbind("error:passwordreset",t),N.unbind("error:passwordreset",b.reject)}),b.promise()}
/**
 * Description
 * @method t
 * @param {} b
 * @return 
 */
function t(b){var c=b.object,d=c.name,e=d.substr(15),f="/_users/"+encodeURIComponent(Q+":"+d),g=btoa(d+":"+e);c._deleted=!0;var h={headers:{Authorization:"Basic "+g},contentType:"application/json",data:JSON.stringify(c)};N.request("PUT",f,h),a.config.unset("_account.resetPasswordId")}
/**
 * Description
 * @method u
 * @param {} a
 * @param {} b
 * @param {} c
 * @return CallExpression
 */
function u(a,b,c){return K(N.username,a,{silent:!0}).then(function(){return N.fetch().then(D(a,b,c))})}
/**
 * Description
 * @method v
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
function v(a,b){var d=c();return u(d,a,b).done(function(){N.trigger("signup",a),h()})}
/**
 * Description
 * @method w
 * @return SequenceExpression
 */
function w(){return a.remote.disconnect(),O._deleted=!0,G("updateUsersDoc",function(){N.request("PUT",C(),{data:JSON.stringify(O),contentType:"application/json"})})}
/**
 * Description
 * @method x
 * @param {} b
 * @return ConditionalExpression
 */
function x(b){return"HoodieNotFoundError"===b.name?a.resolve():a.rejectWith(b)}
/**
 * Description
 * @method y
 * @return SequenceExpression
 */
function y(){return N.trigger("cleanup"),M=void 0,k(void 0),a.resolve()}
/**
 * Description
 * @method z
 * @return CallExpression
 */
function z(){return y().then(function(){return N.trigger("signout")})}
/**
 * Description
 * @method A
 * @param {} b
 * @return SequenceExpression
 */
function A(b){var c;return c=b===a.id()?"user_anonymous":"user",""+c+"/"+b}
/**
 * Description
 * @method B
 * @param {} a
 * @return SequenceExpression
 */
function B(a){return a=a||N.username,""+Q+":"+A(a)}
/**
 * Description
 * @method C
 * @param {} a
 * @return BinaryExpression
 */
function C(a){return"/_users/"+encodeURIComponent(B(a))}
/**
 * Description
 * @method D
 * @param {} a
 * @param {} b
 * @param {} c
 * @return FunctionExpression
 */
function D(a,b,c){return function(){var d=f({},O);b&&(d.$newUsername=b),d.updatedAt=L(),d.signedUpAt=d.signedUpAt||L(),void 0!==c&&(delete d.salt,delete d.password_sha,d.password=c);var e={data:JSON.stringify(d),contentType:"application/json"};return G("updateUsersDoc",function(){return N.request("PUT",C(),e).then(E(b,c||a))})}}
/**
 * Description
 * @method E
 * @param {} b
 * @param {} c
 * @return FunctionExpression
 */
function E(b,c){return function(){return a.remote.disconnect(),b?F(N.username,c).then(function(){return N.signIn(b,c)}):N.signIn(N.username,c)}}
/**
 * Description
 * @method F
 * @param {} b
 * @param {} c
 * @param {} e
 * @return SequenceExpression
 */
function F(b,c,e){e||(e=a.defer());var f={data:{name:A(b),password:c}};return G("signIn",function(){return N.request("POST","/_session",f)}).done(function(){d.setTimeout(F,300,b,c,e)}).fail(function(a){return 401===a.status?e.resolve():void e.reject(a)}),e.promise()}
/**
 * Description
 * @method G
 * @param {} a
 * @param {} b
 * @return SequenceExpression
 */
function G(a,b){return void 0!==P[a]&&"function"==typeof P[a].abort&&P[a].abort(),P[a]=b(),P[a]}
/**
 * Description
 * @method H
 * @param {} a
 * @param {} b
 * @return ConditionalExpression
 */
function H(a,b){return void 0!==P[a]&&"function"==typeof P[a].state&&"pending"===P[a].state()?P[a]:(P[a]=b(),P[a])}
/**
 * Description
 * @method I
 * @param {} b
 * @return ConditionalExpression
 */
function I(b){return a.store.hasLocalChanges()&&!b.ignoreLocalChanges?a.remote.push():a.resolve()}
/**
 * Description
 * @method J
 * @return CallExpression
 */
function J(){return H("signOut",function(){return N.request("DELETE","/_session")})}
/**
 * Description
 * @method K
 * @param {} a
 * @param {} b
 * @param {} c
 * @return CallExpression
 */
function K(a,b,c){var d={data:{name:A(a),password:b}};return G("signIn",function(){var a=N.request("POST","/_session",d);return a.then(p(c))})}
/**
 * Description
 * @method L
 * @return NewExpression
 */
function L(){return new Date}var M,N={},O={},P={},Q="org.couchdb.user";e(a,{context:N,namespace:"account"}),
/**
 * Description
 * @method authenticate
 * @return ConditionalExpression
 */
N.authenticate=function(){var b;return M===!1?a.reject():M===!0?a.resolveWith(N.username):P.signOut&&"pending"===P.signOut.state()?P.signOut.then(a.reject):P.signIn&&"pending"===P.signIn.state()?P.signIn:N.hasAccount()?(
/**
 * Description
 * @return CallExpression
 */
b=function(){return N.request("GET","/_session").then(l)},H("authenticate",b)):J().then(function(){return M=!1,a.reject()})},
/**
 * Description
 * @method hasValidSession
 * @return ConditionalExpression
 */
N.hasValidSession=function(){return N.hasAccount()?M===!0:!1},
/**
 * Description
 * @method hasInvalidSession
 * @return ConditionalExpression
 */
N.hasInvalidSession=function(){return N.hasAccount()?M===!1:!1},
/**
 * Description
 * @method signUp
 * @param {} b
 * @param {} c
 * @return CallExpression
 */
N.signUp=function(b,c){if(void 0===c&&(c=""),!b)return a.rejectWith("Username must be set.");if(N.hasAnonymousAccount())return v(b,c);if(N.hasAccount())return a.rejectWith("Must sign out first.");b=b.toLowerCase();var d={data:JSON.stringify({_id:B(b),name:A(b),type:"user",roles:[],password:c,hoodieId:a.id(),database:N.db(),updatedAt:L(),createdAt:L(),signedUpAt:b!==a.id()?L():void 0}),contentType:"application/json"};return N.request("PUT",C(b),d).then(m(b,c),n(b))},
/**
 * Description
 * @method anonymousSignUp
 * @return SequenceExpression
 */
N.anonymousSignUp=function(){var c,d;return c=g(10),d=a.id(),N.signUp(d,c).done(function(){return b(c),N.trigger("signup:anonymous",d)})},
/**
 * Description
 * @method hasAccount
 * @return UnaryExpression
 */
N.hasAccount=function(){return!!N.username},
/**
 * Description
 * @method hasAnonymousAccount
 * @return BinaryExpression
 */
N.hasAnonymousAccount=function(){return N.username===a.id()};var R="_account.anonymousPassword";
/**
 * Description
 * @method signIn
 * @param {} b
 * @param {} c
 * @param {} d
 * @return SequenceExpression
 */
N.signIn=function(b,c,d){
/**
 * Description
 * @method f
 * @return CallExpression
 */
var e,f=function(){return N.signOut({silent:!0}).then(function(){return K(b,c)})};return d=d||{},null===b&&(b=""),void 0===c&&(c=""),b=b.toLowerCase(),b!==N.username?d.moveData?a.store.findAll().then(function(a){e=a}).then(f).done(function(){e.forEach(function(b){var c=b.type;("$config"!==c||"hoodie"!==b.id)&&(delete b.type,b.createdBy=a.id(),a.store.add(c,b))})}):f():K(b,c,{reauthenticated:!0})},
/**
 * Description
 * @method signOut
 * @param {} b
 * @return SequenceExpression
 */
N.signOut=function(b){return b=b||{},N.hasAccount()?I(b).then(a.remote.disconnect).then(J).then(z):y().then(function(){return b.silent?void 0:N.trigger("signout")})},
/**
 * Description
 * @method request
 * @param {} b
 * @param {} c
 * @param {} d
 * @return SequenceExpression
 */
N.request=function(b,c,d){return d=d||{},a.request.apply(a,arguments)},
/**
 * Description
 * @method db
 * @return BinaryExpression
 */
N.db=function(){return"user/"+a.id()},
/**
 * Description
 * @method fetch
 * @param {} b
 * @return SequenceExpression
 */
N.fetch=function(b){return void 0===b&&(b=N.username),b?H("fetch",function(){return N.request("GET",C(b)).done(function(a){return O=a})}):a.rejectWith({name:"HoodieUnauthorizedError",message:"Not signed in"})},
/**
 * Description
 * @method changePassword
 * @param {} b
 * @param {} c
 * @return ConditionalExpression
 */
N.changePassword=function(b,c){return N.username?(a.remote.disconnect(),N.fetch().then(D(b,null,c))):a.rejectWith({name:"HoodieUnauthorizedError",message:"Not signed in"})},
/**
 * Description
 * @method resetPassword
 * @param {} b
 * @return ConditionalExpression
 */
N.resetPassword=function(b){var c,d,e,f;return(f=a.config.get("_account.resetPasswordId"))?N.checkPasswordReset():(f=""+b+"/"+g(),a.config.set("_account.resetPasswordId",f),d=""+Q+":$passwordReset/"+f,c={_id:d,name:"$passwordReset/"+f,type:"user",roles:[],password:f,createdAt:L(),updatedAt:L()},e={data:JSON.stringify(c),contentType:"application/json"},G("resetPassword",function(){return N.request("PUT","/_users/"+encodeURIComponent(d),e).done(N.checkPasswordReset).then(s)}))},
/**
 * Description
 * @method checkPasswordReset
 * @return ConditionalExpression
 */
N.checkPasswordReset=function(){var b,c,e,f,g;return(e=a.config.get("_account.resetPasswordId"))?(g="$passwordReset/"+e,f="/_users/"+encodeURIComponent(Q+":"+g),b=btoa(g+":"+e),c={headers:{Authorization:"Basic "+b}},H("passwordResetStatus",function(){return N.request("GET",f,c).then(q,r).fail(function(a){return"HoodiePendingError"===a.name?void d.setTimeout(N.checkPasswordReset,1e3):N.trigger("error:passwordreset",a)})})):a.rejectWith("No pending password reset.")},
/**
 * Description
 * @method changeUsername
 * @param {} a
 * @param {} b
 * @return SequenceExpression
 */
N.changeUsername=function(a,b){return b=b||"",u(a,b.toLowerCase())},
/**
 * Description
 * @method destroy
 * @return ConditionalExpression
 */
N.destroy=function(){return N.hasAccount()?N.fetch().then(w,x).then(z):z()},
/**
 * Description
 * @method subscribeToOutsideEvents
 * @return 
 */
N.subscribeToOutsideEvents=function(){i(),delete N.subscribeToOutsideEvents},a.account=N}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/events"),f=a("extend"),g=a("../utils/generate_id");b.exports=c},{"../lib/events":15,"../utils/generate_id":20,extend:1}],4:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @return 
 */
function b(){a.store.find(d,e).done(function(a){f=a})}
/**
 * Description
 * @method c
 * @return 
 */
function c(){a.on("account:cleanup",g.clear)}var d="$config",e="hoodie",f={},g={};
/**
 * Description
 * @method set
 * @param {} b
 * @param {} c
 * @return 
 */
g.set=function(b,c){var g,h;if(f[b]!==c)return f[b]=c,h={},h[b]=c,g="_"===b.charAt(0),"_hoodieId"===b&&(a.store.remove(d,e,{silent:!0}),h=f),a.store.updateOrAdd(d,e,h,{silent:g})},
/**
 * Description
 * @method get
 * @param {} a
 * @return MemberExpression
 */
g.get=function(a){return f[a]},
/**
 * Description
 * @method clear
 * @return SequenceExpression
 */
g.clear=function(){return f={},a.store.remove(d,e)},
/**
 * Description
 * @method unset
 * @param {} b
 * @return ConditionalExpression
 */
g.unset=function(b){return"undefined"==typeof g.get(b)?a.resolve():g.set(b,void 0)},
/**
 * Description
 * @method init
 * @return 
 */
g.init=function(){b(),delete g.init},
/**
 * Description
 * @method subscribeToOutsideEvents
 * @return 
 */
g.subscribeToOutsideEvents=function(){c(),delete g.subscribeToOutsideEvents},a.config=g}b.exports=c},{}],5:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @return SequenceExpression
 */
function b(){return f=3e4,h=d.setTimeout(a.checkConnection,f),a.isConnected()||(a.trigger("reconnected"),e=!0),a.resolve()}
/**
 * Description
 * @method c
 * @return SequenceExpression
 */
function c(){return f=3e3,h=d.setTimeout(a.checkConnection,f),a.isConnected()&&(a.trigger("disconnected"),e=!1),a.reject()}var e=!0,f=3e4,g=null,h=null;
/**
 * Description
 * @method checkConnection
 * @return ConditionalExpression
 */
a.checkConnection=function(){var e=g;return e&&"pending"===e.state()?e:(d.clearTimeout(h),g=a.request("GET","/").then(b,c))},
/**
 * Description
 * @method isConnected
 * @return e
 */
a.isConnected=function(){return e}}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};b.exports=c},{}],6:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @return 
 */
function b(){a.trigger("dispose"),a.unbind()}a.dispose=b}b.exports=c},{}],7:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @return SequenceExpression
 */
function b(){return h||c(d()),h}
/**
 * Description
 * @method c
 * @param {} b
 * @return 
 */
function c(b){h=b,a.config.set("_hoodieId",b)}
/**
 * Description
 * @method e
 * @return 
 */
function e(){h=void 0,a.config.unset("_hoodieId")}
/**
 * Description
 * @method f
 * @return 
 */
function f(){h=a.config.get("_hoodieId"),h||a.config.get("_account.ownerHash")}
/**
 * Description
 * @method g
 * @return 
 */
function g(){a.on("account:cleanup",e),a.on("account:signin",function(a,b){c(b)})}var h;
/**
 * Description
 * @method init
 * @return 
 */
b.init=function(){f(),delete b.init},
/**
 * Description
 * @method subscribeToOutsideEvents
 * @return 
 */
b.subscribeToOutsideEvents=function(){g(),delete b.subscribeToOutsideEvents},a.id=b}var d=a("../utils/generate_id");b.exports=c},{"../utils/generate_id":20}],8:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
function b(b,c){return c=c||{},e(c,{name:b}),d(a,c)}a.open=b}var d=a("../lib/store/remote"),e=a("extend");b.exports=c},{"../lib/store/remote":17,extend:1}],9:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @param {} b
 * @return ConditionalExpression
 */
function b(b){return b?a.config.set("_remote.since",b):a.config.get("_remote.since")||0}
/**
 * Description
 * @method c
 * @return 
 */
function c(){a.on("remote:connect",function(){a.on("store:idle",d.push),d.push()}),a.on("remote:disconnect",function(){a.unbind("store:idle",d.push)}),a.on("disconnected",d.disconnect),a.on("reconnected",d.connect),a.on("account:signin",d.connect),a.on("account:signin:anonymous",d.connect),a.on("account:reauthenticated",d.connect),a.on("account:signout",d.disconnect)}var d=a.open(a.account.db(),{connected:!0,prefix:"",since:b,defaultObjectsToPush:a.store.changedObjects,knownObjects:a.store.index().map(function(a){var b=a.split(/\//);return{type:b[0],id:b[1]}})}),e=d.connect;
/**
 * Description
 * @method connect
 * @return ConditionalExpression
 */
d.connect=function(){return a.account.hasAccount()?e(a.account.db()):a.rejectWith("User has no database to connect to")},
/**
 * Description
 * @method trigger
 * @return CallExpression
 */
d.trigger=function(){var b;b=arguments[0];var c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return a.trigger.apply(a,["remote:"+b].concat(Array.prototype.slice.call(c)))},
/**
 * Description
 * @method on
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
d.on=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.on(b,c)},
/**
 * Description
 * @method unbind
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
d.unbind=function(b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.unbind(b,c)},
/**
 * Description
 * @method subscribeToOutsideEvents
 * @return 
 */
d.subscribeToOutsideEvents=function(){c(),delete d.subscribeToOutsideEvents},a.remote=d}
/**
 * Description
 * @method d
 * @param {} a
 * @return 
 */
function d(a){
/**
 * Description
 * @method b
 * @return 
 */
var b=function(){c(a)};a.remote={init:b}}b.exports=d},{}],10:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @param {} a
 * @return 
 */
function b(a){if(f.isInvalid(a.type))return new f({type:a.type});if(a.id)return g.isInvalid(a.id)?new g({id:a.id}):void 0}
/**
 * Description
 * @method c
 * @param {} a
 * @param {} b
 * @param {} c
 * @param {} d
 * @return ConditionalExpression
 */
function c(a,b,c,d){var e;if(void 0===c&&(c=!1),d=d||{},e=""+a+"/"+b,c){if(i(c,{type:a,id:b}),q(a,b,c),d.remote)return m(a,b),F[e]=i(!0,{},c),F[e]}else{if(F[e]===!1)return!1;if(F[e])return i(!0,{},F[e]);if(c=r(a,b),c===!1)return m(a,b),F[e]=!1,!1}return w(c)?(l(a,b,c,d),F[e]=!1,!1):(F[e]=i(!0,{},c),v(c)?l(a,b,F[e],d):m(a,b),i(!0,{},c))}
/**
 * Description
 * @method j
 * @return 
 */
function j(){var a,b,d,e,f,g,h;if(b=L.getItem("_dirty"))for(b=b.split(","),f=0,g=b.length;g>f;f++)h=b[f].split("/"),e=h[0],a=h[1],d=c(e,a)}
/**
 * Description
 * @method k
 * @return 
 */
function k(){a.on("account:cleanup",J.clear),a.on("account:signup",n),a.on("remote:bootstrap:start",z),a.on("remote:bootstrap:end",A),a.on("remote:bootstrap:error",B),a.on("remote:change",o),a.on("remote:push",p)}
/**
 * Description
 * @method l
 * @param {} a
 * @param {} b
 * @param {} c
 * @param {} d
 * @return 
 */
function l(a,b,c,d){var e;d=d||{},e=""+a+"/"+b,G[e]=c,s(),d.silent||y()}
/**
 * Description
 * @method m
 * @param {} a
 * @param {} b
 * @return SequenceExpression
 */
function m(a,b){var c;return a&&b?(c=""+a+"/"+b,delete G[c]):G={},s(),d.clearTimeout(M)}
/**
 * Description
 * @method n
 * @return CallExpression
 */
function n(){return J.findAll().pipe(function(a){var b,c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],b=""+c.type+"/"+c.id,G[b]=c;s(),y()})}
/**
 * Description
 * @method o
 * @param {} a
 * @param {} b
 * @return 
 */
function o(a,b){"remove"===a?J.remove(b.type,b.id,{remote:!0,update:b}):J.save(b.type,b.id,b,{remote:!0})}
/**
 * Description
 * @method p
 * @param {} a
 * @return 
 */
function p(a){x("sync",a)}
/**
 * Description
 * @method q
 * @param {} a
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
function q(a,b,c){var d,e;return d=""+a+"/"+b,e=i({},c),delete e.type,delete e.id,L.setItem(d,JSON.stringify(e))}
/**
 * Description
 * @method r
 * @param {} a
 * @param {} b
 * @return ConditionalExpression
 */
function r(a,b){var c,d;c=""+a+"/"+b;var e=L.getItem(c);return e?(d=JSON.parse(e),d.type=a,d.id=b,d):!1}
/**
 * Description
 * @method s
 * @return 
 */
function s(){try{if($.isEmptyObject(G))L.removeItem("_dirty");else{var a=Object.keys(G);L.setItem("_dirty",a.join(","))}}catch(b){}}
/**
 * Description
 * @method t
 * @return CallExpression
 */
function t(){return JSON.stringify(new Date).replace(/['"]/g,"")}
/**
 * Description
 * @method u
 * @param {} a
 * @return CallExpression
 */
function u(a){return N.test(a)}
/**
 * Description
 * @method v
 * @param {} a
 * @return ConditionalExpression
 */
function v(a){return a.updatedAt?a._syncedAt?a._syncedAt<a.updatedAt:!0:!1}
/**
 * Description
 * @method w
 * @param {} a
 * @return BinaryExpression
 */
function w(a){return a._deleted===!0}
/**
 * Description
 * @method x
 * @param {} a
 * @param {} b
 * @param {} c
 * @return 
 */
function x(a,b,c){J.trigger(a,i(!0,{},b),c),J.trigger(b.type+":"+a,i(!0,{},b),c),J.trigger(a+":"+b.type,i(!0,{},b),c),"new"!==a&&(J.trigger(b.type+":"+b.id+":"+a,i(!0,{},b),c),J.trigger(a+":"+b.type+":"+b.id,i(!0,{},b),c)),"sync"!==a&&(J.trigger("change",a,i(!0,{},b),c),J.trigger(b.type+":change",a,i(!0,{},b),c),J.trigger("change:"+b.type,a,i(!0,{},b),c),"new"!==a&&(J.trigger(b.type+":"+b.id+":change",a,i(!0,{},b),c),J.trigger("change:"+b.type+":"+b.id,a,i(!0,{},b),c)))}
/**
 * Description
 * @method y
 * @return 
 */
function y(){J.trigger("dirty"),d.clearTimeout(M),M=d.setTimeout(function(){J.trigger("idle",J.changedObjects())},I)}
/**
 * Description
 * @method z
 * @return 
 */
function z(){K=!0,J.trigger("bootstrap:start")}
/**
 * Description
 * @method A
 * @return 
 */
function A(){var a,b,c,d;for(K=!1;H.length>0;)a=H.shift(),b=a[0],c=a[1],d=a[2],E[b].apply(E,c).then(d.resolve,d.reject);J.trigger("bootstrap:end")}
/**
 * Description
 * @method B
 * @param {} a
 * @return 
 */
function B(a){var b,c;for(K=!1;H.length>0;)b=H.shift(),c=b[2],c.reject(a);J.trigger("bootstrap:error",a)}
/**
 * Description
 * @method C
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
function C(b,c){var d=a.defer();return H.push([b,c,d]),d.promise()}
/**
 * Description
 * @method D
 * @return 
 */
function D(){J.isPersistent()||(L={
/**
 * Description
 * @method getItem
 * @return Literal
 */
getItem:function(){return null},
/**
 * Description
 * @method setItem
 * @return Literal
 */
setItem:function(){return null},
/**
 * Description
 * @method removeItem
 * @return Literal
 */
removeItem:function(){return null},
/**
 * Description
 * @method key
 * @return Literal
 */
key:function(){return null},
/**
 * Description
 * @method length
 * @return Literal
 */
length:function(){return 0}})}var E={},F={},G={},H=[],I=2e3;
/**
 * Description
 * @method save
 * @param {} b
 * @param {} d
 * @return CallExpression
 */
E.save=function(b,d){var e,f,g,i,j,k;if(d=d||{},J.isBootstrapping()&&!d.remote)return C("save",arguments);if(b.id?(e=c(b.type,b.id),j="object"!=typeof e):(j=!0,b.id=h()),j?b.createdBy=b.createdBy||a.id():e.createdBy&&(b.createdBy=e.createdBy),!j)for(k in e)if(!b.hasOwnProperty(k))switch(k.charAt(0)){case"_":d.remote&&(b[k]=e[k]);break;case"$":d.remote||(b[k]=e[k])}d.remote?b._syncedAt=t():d.silent||(b.updatedAt=t(),b.createdAt=b.createdAt||b.updatedAt),d.local?b._$local=!0:delete b._$local,f=a.defer();try{b=c(b.type,b.id,b,d),f.resolve(b,j).promise(),i=j?"add":"update",x(i,b,d)}catch(l){g=l,f.reject(g.toString())}return f.promise()},
/**
 * Description
 * @method find
 * @param {} b
 * @param {} d
 * @return 
 */
E.find=function(b,d){var e,f;if(J.isBootstrapping())return C("find",arguments);try{return f=c(b,d),f?a.resolveWith(f):a.rejectWith({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found'})}catch(g){return e=g,a.rejectWith(e)}},
/**
 * Description
 * @method findAll
 * @param {} b
 * @return CallExpression
 */
E.findAll=function(b){var d,e,f,g,h,i,j,k,l;if(null==b&&(
/**
 * Description
 * @return UnaryExpression
 */
b=function(){return!0}),J.isBootstrapping())return C("findAll",arguments);i=J.index(),"string"==typeof b&&(l=b,
/**
 * Description
 * @param {} a
 * @return BinaryExpression
 */
b=function(a){return a.type===l}),e=a.defer();try{k=function(){var a,e,f,k;for(k=[],a=0,e=i.length;e>a;a++)h=i[a],u(h)&&(f=h.split("/"),d=f[0],g=f[1],j=c(d,g),j&&b(j)&&k.push(j));return k}.call(this),k.sort(function(a,b){return a.createdAt>b.createdAt?-1:a.createdAt<b.createdAt?1:0}),e.resolve(k).promise()}catch(m){f=m,e.reject(f).promise()}return e.promise()},
/**
 * Description
 * @method remove
 * @param {} b
 * @param {} d
 * @param {} e
 * @return SequenceExpression
 */
E.remove=function(b,d,e){var f,g,h;return e=e||{},J.isBootstrapping()&&!e.remote?C("remove",arguments):(f=b+"/"+d,g=c(b,d),e.remote&&(L.removeItem(f),h=F[f]&&w(F[f]),F[f]=!1,m(b,d),h&&g)?a.resolveWith(g):g?(g._syncedAt?(g._deleted=!0,c(b,d,g)):(f=b+"/"+d,L.removeItem(f),F[f]=!1,m(b,d)),e.update&&(g=e.update,delete e.update),x("remove",g,e),a.resolveWith(g)):a.rejectWith({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}"" could not be found'}))},
/**
 * Description
 * @method removeAll
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
E.removeAll=function(a,b){return J.findAll(a).then(function(a){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push(J.remove(c.type,c.id,b));return f})};var J=e(a,{validate:b,backend:{save:E.save,find:E.find,findAll:E.findAll,remove:E.remove,removeAll:E.removeAll}});
/**
 * Description
 * @method index
 * @return c
 */
J.index=function(){var a,b,c,d,e;for(c=[],a=d=0,e=L.length();e>=0?e>d:d>e;a=e>=0?++d:--d)b=L.key(a),u(b)&&c.push(b);return c},
/**
 * Description
 * @method changedObjects
 * @return g
 */
J.changedObjects=function(){var a,b,c,d,e,f,g;e=G,g=[];for(b in e)e.hasOwnProperty(b)&&(c=e[b],f=b.split("/"),d=f[0],a=f[1],c.type=d,c.id=a,g.push(c));return g},
/**
 * Description
 * @method hasLocalChanges
 * @param {} a
 * @param {} b
 * @return ConditionalExpression
 */
J.hasLocalChanges=function(a,b){if(!a)return!$.isEmptyObject(G);var d=[a,b].join("/");return G[d]?!0:v(c(a,b))},
/**
 * Description
 * @method clear
 * @return CallExpression
 */
J.clear=function(){var b,c,d,e;b=a.defer();try{d=J.index(),e=function(){var a,b,e;for(e=[],a=0,b=d.length;b>a;a++)c=d[a],u(c)&&e.push(L.removeItem(c));return e}.call(this),F={},m(),b.resolve(),J.trigger("clear")}catch(f){b.reject(f)}return b.promise()};var K=!1;
/**
 * Description
 * @method isBootstrapping
 * @return K
 */
J.isBootstrapping=function(){return K},
/**
 * Description
 * @method isPersistent
 * @return UnaryExpression
 */
J.isPersistent=function(){try{if(!d.localStorage)return!1;if(localStorage.setItem("Storage-Test","1"),"1"!==localStorage.getItem("Storage-Test"))return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0};var L={
/**
 * Description
 * @method getItem
 * @param {} a
 * @return CallExpression
 */
getItem:function(a){return d.localStorage.getItem(a)},
/**
 * Description
 * @method setItem
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
setItem:function(a,b){return d.localStorage.setItem(a,b)},
/**
 * Description
 * @method removeItem
 * @param {} a
 * @return CallExpression
 */
removeItem:function(a){return d.localStorage.removeItem(a)},
/**
 * Description
 * @method key
 * @param {} a
 * @return CallExpression
 */
key:function(a){return d.localStorage.key(a)},
/**
 * Description
 * @method length
 * @return MemberExpression
 */
length:function(){return d.localStorage.length}};
/**
 * Description
 * @method subscribeToOutsideEvents
 * @return 
 */
J.subscribeToOutsideEvents=function(){k(),delete J.subscribeToOutsideEvents};var M,N=new RegExp(/^[a-z$][a-z0-9]+\/[a-z0-9]+$/);a.store=J,
/**
 * Description
 * @method bootstrapDirtyObjects
 * @return 
 */
J.bootstrapDirtyObjects=function(){j(),delete J.bootstrapDirtyObjects},
/**
 * Description
 * @method patchIfNotPersistant
 * @return 
 */
J.patchIfNotPersistant=function(){D(),delete J.patchIfNotPersistant}}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/store/api"),f=a("../lib/error/object_type"),g=a("../lib/error/object_id"),h=a("../utils/generate_id"),i=a("extend");b.exports=c},{"../lib/error/object_id":13,"../lib/error/object_type":14,"../lib/store/api":16,"../utils/generate_id":20,extend:1}],11:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @return 
 */
function b(){a.on("store:change",i)}
/**
 * Description
 * @method c
 * @param {} b
 * @return SequenceExpression
 */
function c(b){var c=a.defer(),d=a.store(b.type,b.id);return d.on("remove",function(a){return a.type=a.type.substr(1),a.$processedAt?c.resolve(a):void c.reject(new f({message:"Task has been cancelled",task:a}))}),d.on("update",function(b){var d=b.$error;b.$error&&(b.type=b.type.substr(1),delete b.$error,d.object=b,d.message=d.message||"Something went wrong",c.reject(new f(d)),a.store.remove("$"+b.type,b.id))}),c.promise()}
/**
 * Description
 * @method h
 * @param {} b
 * @return ConditionalExpression
 */
function h(b){var c,d=b.type,e=b.id,f=a.store.remove(d,e);return b._rev?(c=a.defer(),a.one("store:sync:"+d+":"+e,c.resolve),f.fail(c.reject),c.promise()):f}
/**
 * Description
 * @method i
 * @param {} a
 * @param {} b
 * @param {} c
 * @return 
 */
function i(a,b,c){"$"===b.type[0]&&(b.type=b.type.substr(1),m(a,b,c))}
/**
 * Description
 * @method j
 * @param {} b
 * @return SequenceExpression
 */
function j(b){var c,d="$";return b&&(d+=b),
/**
 * Description
 * @param {} a
 * @return BinaryExpression
 */
c=function(a){return 0===a.type.indexOf(d)},a.store.findAll(c)}
/**
 * Description
 * @method k
 * @param {} a
 * @return CallExpression
 */
function k(a){return a.map(function(a){return o.cancel(a.type.substr(1),a.id)})}
/**
 * Description
 * @method l
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
function l(a,b){return a.map(function(a){return o.restart(a.type.substr(1),a.id,b)})}
/**
 * Description
 * @method m
 * @param {} a
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
function m(a,b,c){var d;return"add"===a&&(a="start"),"remove"===a&&b.cancelledAt&&(a="cancel"),"remove"===a&&b.$processedAt&&(a="success"),"update"===a&&b.$error?(a="error",d=b.$error,delete b.$error,o.trigger("error",d,b,c),o.trigger(b.type+":error",d,b,c),o.trigger(b.type+":"+b.id+":error",d,b,c),c=g({},c,{error:d}),o.trigger("change","error",b,c),o.trigger(b.type+":change","error",b,c),void o.trigger(b.type+":"+b.id+":change","error",b,c)):void(("start"===a||"cancel"===a||"success"===a)&&(o.trigger(a,b,c),o.trigger(b.type+":"+a,b,c),"start"!==a&&o.trigger(b.type+":"+b.id+":"+a,b,c),o.trigger("change",a,b,c),o.trigger(b.type+":change",a,b,c),"start"!==a&&o.trigger(b.type+":"+b.id+":change",a,b,c)))}
/**
 * Description
 * @method n
 * @return CallExpression
 */
function n(){return JSON.stringify(new Date).replace(/['"]/g,"")}
/**
 * Description
 * @method o
 * @param {} b
 * @param {} c
 * @return CallExpression
 */
var o=function p(b,c){return e(a,p,{type:b,id:c})};d(a,{context:o,namespace:"task"}),
/**
 * Description
 * @method start
 * @param {} b
 * @param {} d
 * @return ConditionalExpression
 */
o.start=function(b,d){return a.account.hasAccount()?a.store.add("$"+b,d).then(c):a.account.anonymousSignUp().then(function(){return o.start(b,d)})},
/**
 * Description
 * @method cancel
 * @param {} b
 * @param {} c
 * @return CallExpression
 */
o.cancel=function(b,c){return a.store.update("$"+b,c,{cancelledAt:n()}).then(h)},
/**
 * Description
 * @method restart
 * @param {} a
 * @param {} b
 * @param {} c
 * @return CallExpression
 */
o.restart=function(a,b,c){
/**
 * Description
 * @method d
 * @param {} a
 * @return SequenceExpression
 */
var d=function(a){return g(a,c),delete a.$error,delete a.$processedAt,delete a.cancelledAt,o.start(a.type,a)};return o.cancel(a,b).then(d)},
/**
 * Description
 * @method cancelAll
 * @param {} a
 * @return CallExpression
 */
o.cancelAll=function(a){return j(a).then(k)},
/**
 * Description
 * @method restartAll
 * @param {} a
 * @param {} b
 * @return SequenceExpression
 */
o.restartAll=function(a,b){return"object"==typeof a&&(b=a),j(a).then(function(a){l(a,b)})},
/**
 * Description
 * @method subscribeToOutsideEvents
 * @return 
 */
o.subscribeToOutsideEvents=function(){b(),delete o.subscribeToOutsideEvents},a.task=o}var d=a("../lib/events"),e=a("../lib/task/scoped"),f=a("../lib/error/error"),g=a("extend");b.exports=c},{"../lib/error/error":12,"../lib/events":15,"../lib/task/scoped":19,extend:1}],12:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){if("string"==typeof a&&(a={message:a}),!a.message)throw new Error("FATAL: error.message must be set");a.name||(a.name="HoodieError"),a.message=a.message.replace(d,function(b){var c=b.match(e)[0];return a[c]}),f(this,a)}var d=/\{\{\s*\w+\s*\}\}/g,e=/\w+/,f=a("extend");c.prototype=new Error,c.prototype.constructor=c,b.exports=c},{extend:1}],13:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return SequenceExpression
 */
function c(a){return a.name="HoodieObjectIdError",a.message='"{{id}}" is invalid object id. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z0-9\-]+$/;
/**
 * Description
 * @method isInvalid
 * @param {} a
 * @param {} b
 * @return UnaryExpression
 */
c.isInvalid=function(a,b){return!(b||e).test(a||"")},
/**
 * Description
 * @method isValid
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":12}],14:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return SequenceExpression
 */
function c(a){return a.name="HoodieObjectTypeError",a.message='"{{type}}" is invalid object type. {{rules}}.',new d(a)}var d=a("./error"),e=/^[a-z$][a-z0-9]+$/;
/**
 * Description
 * @method isInvalid
 * @param {} a
 * @param {} b
 * @return UnaryExpression
 */
c.isInvalid=function(a,b){return!(b||e).test(a||"")},
/**
 * Description
 * @method isValid
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
c.isValid=function(a,b){return(b||e).test(a||"")},c.prototype.rules="lowercase letters, numbers and dashes allowed only. Must start with a letter",b.exports=c},{"./error":12}],15:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @param {} b
 * @return 
 */
function c(a,b){
/**
 * Description
 * @method c
 * @param {} b
 * @param {} c
 * @return 
 */
function c(b,c){var d,e,f,g;for(d=b.split(" "),f=0,g=d.length;g>f;f++)e=h+d[f],a.eventsCallbacks[e]=a.eventsCallbacks[e]||[],a.eventsCallbacks[e].push(c)}
/**
 * Description
 * @method d
 * @param {} b
 * @param {} c
 * @return 
 */
function d(b,c){b=h+b;
/**
 * Description
 * @method d
 * @return 
 */
var d=function(){a.unbind(b,d),c.apply(null,arguments)};a.bind(b,d)}
/**
 * Description
 * @method e
 * @return 
 */
function e(){var b,c,d,e,f,g;if(b=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],d=b.shift(),d=h+d,e=a.eventsCallbacks[d]){for(f=0,g=e.length;g>f;f++)c=e[f],c.apply(null,b);return!0}}
/**
 * Description
 * @method f
 * @param {} b
 * @param {} c
 * @return 
 */
function f(b,c){var d,e,f,g,i,j;if(!b)return h||(a.eventsCallbacks={}),j=Object.keys(a.eventsCallbacks),j=j.filter(function(a){return 0===a.indexOf(h)}),void j.forEach(function(b){delete a.eventsCallbacks[b]});if(b=h+b,f=a.eventsCallbacks[b]){if(!c)return void delete a.eventsCallbacks[b];for(e=g=0,i=f.length;i>g;e=++g)if(d=f[e],d===c){f=f.slice(),f.splice(e,1),a.eventsCallbacks[b]=f;break}}}var g=a,h="";b=b||{},a.eventsCallbacks||(a.eventsCallbacks={}),b.context&&(g=b.context,h=b.namespace+":"),g.bind=c,g.on=c,g.one=d,g.trigger=e,g.unbind=f,g.off=f}b.exports=c},{}],16:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @param {} b
 * @return m
 */
function c(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return CallExpression
 */
function c(a){return i(a,k)}
/**
 * Description
 * @method m
 * @param {} c
 * @param {} e
 * @return CallExpression
 */
var j={},k={hoodie:a},l=b.name||"store",m=function q(c,e){var f=i(!0,{type:c,id:e},b);return d(a,q,f)};if(e(a,{context:m,namespace:l}),m.validate=b.validate,b.validate||(
/**
 * Description
 * @method validate
 * @param {} a
 * @return 
 */
m.validate=function(a){if(!a)return new f({name:"InvalidObjectError",message:"No object passed."});if(g.isInvalid(a.type,o))return new g({type:a.type,rules:p});if(a.id)return h.isInvalid(a.id,o)?new h({id:a.id,rules:p}):void 0}),
/**
 * Description
 * @method save
 * @param {} b
 * @param {} d
 * @param {} e
 * @param {} f
 * @return ConditionalExpression
 */
m.save=function(b,d,e,f){f=f?i(!0,{},f):{};var g=i(!0,{},e,{type:b,id:d}),h=m.validate(g,f||{});return h?a.rejectWith(h):c(j.save(g,f||{}))},
/**
 * Description
 * @method add
 * @param {} a
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
m.add=function(a,b,c){return void 0===b&&(b={}),c=c||{},m.save(a,b.id,b,c)},
/**
 * Description
 * @method find
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
m.find=function(a,b){return c(j.find(a,b))},
/**
 * Description
 * @method findOrAdd
 * @param {} a
 * @param {} b
 * @param {} d
 * @return CallExpression
 */
m.findOrAdd=function(a,b,d){
/**
 * Description
 * @method e
 * @return SequenceExpression
 */
function e(){var c;return c=i(!0,{id:b},d),m.add(a,c)}null===d&&(d={});var f=m.find(a,b).then(null,e);return c(f)},
/**
 * Description
 * @method findAll
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
m.findAll=function(a,b){return c(j.findAll(a,b))},
/**
 * Description
 * @method update
 * @param {} b
 * @param {} d
 * @param {} e
 * @param {} f
 * @return CallExpression
 */
m.update=function(b,d,e,f){
/**
 * Description
 * @method g
 * @param {} c
 * @return SequenceExpression
 */
function g(c){var g,h,j;return h=i(!0,{},c),"function"==typeof e&&(e=e(h)),e?(g=function(){var a=[];for(var b in e)if(e.hasOwnProperty(b)){if(j=e[b],c[b]!==j==!1)continue;h[b]=j,a.push(b)}return a}(),g.length||f?m.save(b,d,h,f):a.resolveWith(h)):a.resolveWith(c)}var h=m.find(b,d).then(g);return c(h)},
/**
 * Description
 * @method updateOrAdd
 * @param {} a
 * @param {} b
 * @param {} d
 * @param {} e
 * @return CallExpression
 */
m.updateOrAdd=function(a,b,d,e){
/**
 * Description
 * @method f
 * @return CallExpression
 */
function f(){var c=i(!0,{},d,{id:b});return m.add(a,c,e)}var g=m.update(a,b,d,e).then(null,f);return c(g)},
/**
 * Description
 * @method updateAll
 * @param {} b
 * @param {} d
 * @param {} e
 * @return SequenceExpression
 */
m.updateAll=function(b,d,e){var f;switch(e=e||{},!0){case"string"==typeof b:f=m.findAll(b);break;case a.isPromise(b):f=b;break;case $.isArray(b):f=a.defer().resolve(b).promise();break;default:f=m.findAll()}return f=f.then(function(a){var b,c;return $.isArray(a)||(a=[a]),c=function(){var c,f,g;for(g=[],c=0,f=a.length;f>c;c++)b=a[c],g.push(m.update(b.type,b.id,d,e));return g}(),$.when.apply(null,c)}),c(f)},
/**
 * Description
 * @method remove
 * @param {} a
 * @param {} b
 * @param {} d
 * @return CallExpression
 */
m.remove=function(a,b,d){return c(j.remove(a,b,d||{}))},
/**
 * Description
 * @method removeAll
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
m.removeAll=function(a,b){return c(j.removeAll(a,b||{}))},
/**
 * Description
 * @method decoratePromises
 * @param {} a
 * @return CallExpression
 */
m.decoratePromises=function(a){return i(k,a)},!b.backend)throw new Error("options.backend must be passed");var n="save find findAll remove removeAll".split(" ");n.forEach(function(a){if(!b.backend[a])throw new Error("options.backend."+a+" must be passed.");j[a]=b.backend[a]});var o=/^[^\/]+$/,p="/ not allowed";return m}var d=a("./scoped"),e=a("../events"),f=a("../error/error"),g=a("../error/object_type"),h=a("../error/object_id"),i=a("extend");b.exports=c},{"../error/error":12,"../error/object_id":13,"../error/object_type":14,"../events":15,"./scoped":18,extend:1}],17:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @param {} b
 * @return v
 */
function c(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return ConditionalExpression
 */
function c(a){return"function"==typeof y?y(a):y=a}
/**
 * Description
 * @method h
 * @param {} a
 * @return SequenceExpression
 */
function h(a){var b,c;c=f({},a);for(b in c)if(c.hasOwnProperty(b)){if(-1!==E.indexOf(b))continue;if(!/^_/.test(b))continue;delete c[b]}return c._id=""+c.type+"/"+c.id,v.prefix&&(c._id=""+v.prefix+c._id),delete c.id,c}
/**
 * Description
 * @method i
 * @param {} a
 * @return SequenceExpression
 */
function i(a){var b,c,d;return b=a._id||a.id,delete a._id,v.prefix&&(b=b.replace(x,"")),d=b.match(/([^\/]+)\/(.*)/),c=d[0],a.type=d[1],a.id=d[2],a}
/**
 * Description
 * @method j
 * @param {} a
 * @return e
 */
function j(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(i(b));return e}
/**
 * Description
 * @method k
 * @param {} a
 * @return SequenceExpression
 */
function k(a){var b,c,d,e;try{e=a._rev.split(/-/),c=e[0],b=e[1]}catch(f){}return c=parseInt(c,10)||0,d=l(),a._$local&&(d+="-local"),a._rev=""+(c+1)+"-"+d,a._revisions={start:1,ids:[d]},b?(a._revisions.start+=c,a._revisions.ids.push(b)):void 0}
/**
 * Description
 * @method l
 * @return CallExpression
 */
function l(){return g(9)}
/**
 * Description
 * @method m
 * @param {} a
 * @return CallExpression
 */
function m(a){return a.rows.map(function(a){return a.doc})}
/**
 * Description
 * @method n
 * @return SequenceExpression
 */
function n(){var a;return a=v.getSinceNr(),v.isConnected()&&!z?"/_changes?include_docs=true&since="+a+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+a}
/**
 * Description
 * @method o
 * @return 
 */
function o(){A&&A.abort()}
/**
 * Description
 * @method p
 * @param {} a
 * @return SequenceExpression
 */
function p(a){return c(a.last_seq),t(a.results),v.isConnected()?v.pull():void 0}
/**
 * Description
 * @method q
 * @param {} b
 * @param {} c
 * @return 
 */
function q(b,c){if(v.isConnected())switch(b.status){case 401:return v.trigger("error:unauthenticated",c),v.disconnect();case 404:return d.setTimeout(v.pull,3e3);case 500:return v.trigger("error:server",c),d.setTimeout(v.pull,3e3),a.checkConnection();default:return"abort"===b.statusText?v.pull():(d.setTimeout(v.pull,3e3),a.checkConnection())}}
/**
 * Description
 * @method r
 * @return 
 */
function r(){z=!1,v.trigger("bootstrap:end")}
/**
 * Description
 * @method s
 * @param {} a
 * @return 
 */
function s(a){z=!1,v.trigger("bootstrap:error",a)}
/**
 * Description
 * @method t
 * @param {} a
 * @return 
 */
function t(a){var b,c,d,e,f;for(e=0,f=a.length;f>e;e++)if(b=a[e].doc,!v.prefix||0===b._id.indexOf(v.prefix)){if(d=i(b),d._deleted){if(!v.isKnownObject(d))continue;c="remove",v.isKnownObject(d)}else v.isKnownObject(d)?c="update":(c="add",v.markAsKnownObject(d));v.trigger(c,d),v.trigger(c+":"+d.type,d),v.trigger(c+":"+d.type+":"+d.id,d),v.trigger("change",c,d),v.trigger("change:"+d.type,c,d),v.trigger("change:"+d.type+":"+d.id,c,d)}}var u={};
/**
 * Description
 * @method find
 * @param {} a
 * @param {} b
 * @return SequenceExpression
 */
u.find=function(a,b){var c;return c=a+"/"+b,v.prefix&&(c=v.prefix+c),c="/"+encodeURIComponent(c),v.request("GET",c).then(i)},
/**
 * Description
 * @method findAll
 * @param {} a
 * @return SequenceExpression
 */
u.findAll=function(a){var b,c,d;switch(c="/_all_docs?include_docs=true",!0){case void 0!==a&&""!==v.prefix:d=v.prefix+a+"/";break;case void 0!==a:d=a+"/";break;case""!==v.prefix:d=v.prefix;break;default:d=""}return d&&(b=d.replace(/.$/,function(a){var b;return b=a.charCodeAt(0),String.fromCharCode(b+1)}),c=""+c+'&startkey="'+encodeURIComponent(d)+'"&endkey="'+encodeURIComponent(b)+'"'),v.request("GET",c).then(m).then(j)},
/**
 * Description
 * @method save
 * @param {} a
 * @return SequenceExpression
 */
u.save=function(a){var b;return a.id||(a.id=g()),a=h(a),b="/"+encodeURIComponent(a._id),v.request("PUT",b,{data:a})},
/**
 * Description
 * @method remove
 * @param {} a
 * @param {} b
 * @return CallExpression
 */
u.remove=function(a,b){return v.update(a,b,{_deleted:!0})},
/**
 * Description
 * @method removeAll
 * @param {} a
 * @return CallExpression
 */
u.removeAll=function(a){return v.updateAll(a,{_deleted:!0})};var v=e(a,{name:b.name,backend:{save:u.save,find:u.find,findAll:u.findAll,remove:u.remove,removeAll:u.removeAll}}),w=null;v.connected=!1,v.prefix="";var x=new RegExp("^");void 0!==b.name&&(w=b.name),void 0!==b.prefix&&(v.prefix=b.prefix,x=new RegExp("^"+v.prefix)),null!==b.baseUrl&&(v.baseUrl=b.baseUrl),
/**
 * Description
 * @method request
 * @param {} b
 * @param {} c
 * @param {} d
 * @return SequenceExpression
 */
v.request=function(b,c,d){return d=d||{},w&&(c="/"+encodeURIComponent(w)+c),v.baseUrl&&(c=""+v.baseUrl+c),d.contentType=d.contentType||"application/json",("POST"===b||"PUT"===b)&&(d.dataType=d.dataType||"json",d.processData=d.processData||!1,d.data=JSON.stringify(d.data)),a.request(b,c,d)
},
/**
 * Description
 * @method isKnownObject
 * @param {} a
 * @return ConditionalExpression
 */
v.isKnownObject=function(a){var b=""+a.type+"/"+a.id;return void 0!==D[b]?D[b]:void 0},
/**
 * Description
 * @method markAsKnownObject
 * @param {} a
 * @return SequenceExpression
 */
v.markAsKnownObject=function(a){var b=""+a.type+"/"+a.id;return D[b]=1,D[b]},
/**
 * Description
 * @method connect
 * @param {} a
 * @return SequenceExpression
 */
v.connect=function(a){return a&&(w=a),v.connected=!0,v.trigger("connect"),v.bootstrap().then(function(){v.push()})},
/**
 * Description
 * @method disconnect
 * @return 
 */
v.disconnect=function(){v.connected=!1,v.trigger("disconnect"),A&&A.abort(),C&&C.abort()},
/**
 * Description
 * @method isConnected
 * @return MemberExpression
 */
v.isConnected=function(){return v.connected};var y=b.since||0;
/**
 * Description
 * @method getSinceNr
 * @return ConditionalExpression
 */
v.getSinceNr=function(){return"function"==typeof y?y():y};var z=!1;
/**
 * Description
 * @method bootstrap
 * @return SequenceExpression
 */
v.bootstrap=function(){return z=!0,v.trigger("bootstrap:start"),v.pull().done(r).fail(s)};var A,B;
/**
 * Description
 * @method pull
 * @return SequenceExpression
 */
v.pull=function(){return A=v.request("GET",n()),v.isConnected()&&(d.clearTimeout(B),B=d.setTimeout(o,25e3)),A.done(p).fail(q)};var C;
/**
 * Description
 * @method push
 * @param {} b
 * @return SequenceExpression
 */
v.push=function(b){var c,d,e,g;if($.isArray(b)||(b=F()),0===b.length)return a.resolveWith([]);for(d=[],e=0,g=b.length;g>e;e++)c=f(!0,{},b[e]),k(c),c=h(c),d.push(c);return C=v.request("POST","/_bulk_docs",{data:{docs:d,new_edits:!1}}),C.done(function(){for(var a=0;a<b.length;a++)v.trigger("push",b[a])}),C},
/**
 * Description
 * @method sync
 * @param {} a
 * @return CallExpression
 */
v.sync=function(a){return v.push(a).then(v.pull)};
/**
 * Description
 * @method F
 * @return ArrayExpression
 */
var D={},E=["_id","_rev","_deleted","_revisions","_attachments"],F=function(){return[]};if(b.defaultObjectsToPush&&(F=$.isArray(b.defaultObjectsToPush)?function(){return b.defaultObjectsToPush}:b.defaultObjectsToPush),b.knownObjects)for(var G=0;G<b.knownObjects.length;G++)v.markAsKnownObject({type:b.knownObjects[G].type,id:b.knownObjects[G].id});return v}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("./api"),f=a("extend"),g=a("../../utils/generate_id");b.exports=c},{"../../utils/generate_id":20,"./api":16,extend:1}],18:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
function c(a,b,c){var e=c.name||"store",f=c.type,g=c.id,h={};return g||(d(a,{context:h,namespace:e+":"+f}),
/**
 * Description
 * @method save
 * @param {} a
 * @param {} c
 * @param {} d
 * @return CallExpression
 */
h.save=function(a,c,d){return b.save(f,a,c,d)},
/**
 * Description
 * @method add
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
h.add=function(a,c){return b.add(f,a,c)},
/**
 * Description
 * @method find
 * @param {} a
 * @return CallExpression
 */
h.find=function(a){return b.find(f,a)},
/**
 * Description
 * @method findOrAdd
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
h.findOrAdd=function(a,c){return b.findOrAdd(f,a,c)},
/**
 * Description
 * @method findAll
 * @param {} a
 * @return CallExpression
 */
h.findAll=function(a){return b.findAll(f,a)},
/**
 * Description
 * @method update
 * @param {} a
 * @param {} c
 * @param {} d
 * @return CallExpression
 */
h.update=function(a,c,d){return b.update(f,a,c,d)},
/**
 * Description
 * @method updateAll
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
h.updateAll=function(a,c){return b.updateAll(f,a,c)},
/**
 * Description
 * @method remove
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
h.remove=function(a,c){return b.remove(f,a,c)},
/**
 * Description
 * @method removeAll
 * @param {} a
 * @return CallExpression
 */
h.removeAll=function(a){return b.removeAll(f,a)}),g&&(d(a,{context:h,namespace:e+":"+f+":"+g}),
/**
 * Description
 * @method save
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
h.save=function(a,c){return b.save(f,g,a,c)},
/**
 * Description
 * @method find
 * @return CallExpression
 */
h.find=function(){return b.find(f,g)},
/**
 * Description
 * @method update
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
h.update=function(a,c){return b.update(f,g,a,c)},
/**
 * Description
 * @method remove
 * @param {} a
 * @return CallExpression
 */
h.remove=function(a){return b.remove(f,g,a)}),h.decoratePromises=b.decoratePromises,h.validate=b.validate,h}var d=a("../events");b.exports=c},{"../events":15}],19:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @param {} b
 * @param {} c
 * @return SequenceExpression
 */
function c(a,b,c){var e=c.type,f=c.id,g={};return f||(d(a,{context:g,namespace:"task:"+e}),
/**
 * Description
 * @method start
 * @param {} a
 * @return CallExpression
 */
g.start=function(a){return b.start(e,a)},
/**
 * Description
 * @method cancel
 * @param {} a
 * @return CallExpression
 */
g.cancel=function(a){return b.cancel(e,a)},
/**
 * Description
 * @method restart
 * @param {} a
 * @param {} c
 * @return CallExpression
 */
g.restart=function(a,c){return b.restart(e,a,c)},
/**
 * Description
 * @method cancelAll
 * @return CallExpression
 */
g.cancelAll=function(){return b.cancelAll(e)},
/**
 * Description
 * @method restartAll
 * @param {} a
 * @return CallExpression
 */
g.restartAll=function(a){return b.restartAll(e,a)}),f&&(d(a,{context:g,namespace:"task:"+e+":"+f}),
/**
 * Description
 * @method cancel
 * @return CallExpression
 */
g.cancel=function(){return b.cancel(e,f)},
/**
 * Description
 * @method restart
 * @param {} a
 * @return CallExpression
 */
g.restart=function(a){return b.restart(e,f,a)}),g}var d=a("../events");b.exports=c},{"../events":15}],20:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return b
 */
function c(a){var b="";for(void 0===a&&(a=7),e=0;a>e;e++){var c=Math.random()*f,g=d[Math.floor(c)];b+=String(g).charAt(0)}return b}var d,e,f;d="0123456789abcdefghijklmnopqrstuvwxyz".split(""),f=d.length,b.exports=c},{}],21:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return SequenceExpression
 */
function c(a){return a=a.replace(d,function(a){return(a[1]||a[0]).toUpperCase()}),"Hoodie"+a+"Error"}var d=/(^\w|_\w)/g;b.exports=c},{}],22:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @param {} a
 * @return UnaryExpression
 */
function b(a){return!(!a||"function"!=typeof a.done||"function"==typeof a.resolve)}
/**
 * Description
 * @method c
 * @return CallExpression
 */
function c(){return i().resolve().promise()}
/**
 * Description
 * @method f
 * @return CallExpression
 */
function f(){return i().reject().promise()}
/**
 * Description
 * @method g
 * @return CallExpression
 */
function g(){var a=i();return a.resolve.apply(a,arguments).promise()}
/**
 * Description
 * @method h
 * @param {} a
 * @return CallExpression
 */
function h(a){var b=i(),c=new e(a);return b.reject(c).promise()}var i=d.jQuery.Deferred;a.defer=i,a.isPromise=b,a.resolve=c,a.reject=f,a.resolveWith=g,a.rejectWith=h}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("../lib/error/error");b.exports=c},{"../lib/error/error":12}],23:[function(a,b){
/**
 * Description
 * @method c
 * @param {} a
 * @return 
 */
function c(a){
/**
 * Description
 * @method b
 * @param {} b
 * @param {} d
 * @param {} f
 * @return SequenceExpression
 */
function b(b,d,f){var i,j,k;return f=f||{},i={type:b,dataType:"json"},/^http/.test(d)||(d=(a.baseUrl||"")+h+d),/^http/.test(d)&&(i.xhrFields={withCredentials:!0},i.crossDomain=!0),i.url=d,j=g(e(i,f)),k=j.then(null,c),k.abort=j.abort,k}
/**
 * Description
 * @method c
 * @param {} b
 * @return CallExpression
 */
function c(b){var c;try{c=f(b)}catch(d){c=b.responseText?b.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:a.baseUrl||"/"}}return a.rejectWith(c).promise()}
/**
 * Description
 * @method f
 * @param {} a
 * @return SequenceExpression
 */
function f(a){var b=JSON.parse(a.responseText);return b.name=i[a.status],b.name||(b.name=d(b.error)),b.status=a.status,b.message=b.reason||"",b.message=b.message.charAt(0).toUpperCase()+b.message.slice(1),delete b.error,delete b.reason,b}var g=$.ajax,h="/_api",i={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"};a.request=b}var d=a("./hoodiefy_request_error_name"),e=a("extend");b.exports=c},{"./hoodiefy_request_error_name":21,extend:1}]},{},[2])(2)});